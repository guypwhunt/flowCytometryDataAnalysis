singleCluster <- FALSE
concatinatedVisits <- toString(visits)
# Read experiment data
experimentInfo <- read.csv("data/metadata/metadata.csv")
if (markersOrCells != "Clusters") {
cellPopulationMarkers <- read.csv(paste0("data/", directoryName, "/clusteringOutput/", clusterName, markersOrCells, ".csv"))
}
if (directoryName == "monocytes") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074-2", arr.ind=TRUE), "sample_id"] <- "BLT00074-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075-4", arr.ind=TRUE), "sample_id"] <- "BLT00075-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00092-6", arr.ind=TRUE), "sample_id"] <- "BLT00092-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186-6", arr.ind=TRUE), "sample_id"] <- "BLT00186-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-09"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-3", arr.ind=TRUE), "sample_id"] <- "BLT00211-03"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-6", arr.ind=TRUE), "sample_id"] <- "BLT00211-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-6", arr.ind=TRUE), "sample_id"] <- "BLT00211-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-2", arr.ind=TRUE), "sample_id"] <- "BLT00214-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-5", arr.ind=TRUE), "sample_id"] <- "BLT00214-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00230-2", arr.ind=TRUE), "sample_id"] <- "BLT00230-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243-7", arr.ind=TRUE), "sample_id"] <- "BLT00243-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-4", arr.ind=TRUE), "sample_id"] <- "BLT00244-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-6", arr.ind=TRUE), "sample_id"] <- "BLT00244-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-6", arr.ind=TRUE), "sample_id"] <- "BLT00244-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00254-5", arr.ind=TRUE), "sample_id"] <- "BLT00254-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00254-7", arr.ind=TRUE), "sample_id"] <- "BLT00254-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-4", arr.ind=TRUE), "sample_id"] <- "BLT00265-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-4", arr.ind=TRUE), "sample_id"] <- "BLT00265-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-8", arr.ind=TRUE), "sample_id"] <- "BLT00265-08"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00271-4", arr.ind=TRUE), "sample_id"] <- "BLT00271-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00271-7", arr.ind=TRUE), "sample_id"] <- "BLT00271-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-6", arr.ind=TRUE), "sample_id"] <- "BLT00274-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-3", arr.ind=TRUE), "sample_id"] <- "BLT00285-03"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-5", arr.ind=TRUE), "sample_id"] <- "BLT00285-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-5", arr.ind=TRUE), "sample_id"] <- "BLT00285-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00286-6", arr.ind=TRUE), "sample_id"] <- "BLT00286-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244_02", arr.ind=TRUE), "sample_id"] <- "BLT0244_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="QS_024-2", arr.ind=TRUE), "sample_id"] <- "QS_024-02"
} else if (directoryName == "senescence") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074_04", arr.ind=TRUE), "sample_id"] <- "BLT00074-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075_06", arr.ind=TRUE), "sample_id"] <- "BLT00075-6"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_02", arr.ind=TRUE), "sample_id"] <- "BLT00186-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-9"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00261_2", arr.ind=TRUE), "sample_id"] <- "BLT00261-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075-4", arr.ind=TRUE), "sample_id"] <- "BLT00075-4_R1"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-3", arr.ind=TRUE), "sample_id"] <- "BLT00211-3 "
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-5", arr.ind=TRUE), "sample_id"] <- "BLT000214-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00057_04", arr.ind=TRUE), "sample_id"] <- "BLT00057-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00092_04", arr.ind=TRUE), "sample_id"] <- "BLT00092_4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00198_02", arr.ind=TRUE), "sample_id"] <- "BLT00198_2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214_04", arr.ind=TRUE), "sample_id"] <- "BLT00214-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00230_04", arr.ind=TRUE), "sample_id"] <- "BLT00230-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00242_02", arr.ind=TRUE), "sample_id"] <- "BLT00242-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243_05", arr.ind=TRUE), "sample_id"] <- "BLT00243-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274_02", arr.ind=TRUE), "sample_id"] <- "BLT00274-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243_05", arr.ind=TRUE), "sample_id"] <- "BLT00243-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274_02", arr.ind=TRUE), "sample_id"] <- "BLT00274-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-05", arr.ind=TRUE), "sample_id"] <- "BLT00274-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-5"
} else if (directoryName == "tCells") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_033_02", arr.ind=TRUE), "sample_id"] <- "BAS033_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074_04", arr.ind=TRUE), "sample_id"] <- "BLT00074-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075_06", arr.ind=TRUE), "sample_id"] <- "BLT00075-6"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_02", arr.ind=TRUE), "sample_id"] <- "BLT00186_2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS101", arr.ind=TRUE), "sample_id"] <- "BAS00101"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-9"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00261_2", arr.ind=TRUE), "sample_id"] <- "BLT00261_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-05", arr.ind=TRUE), "sample_id"] <- "BLT00274-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
}
experimentInfo
experimentInfo <-
experimentInfo[order(experimentInfo[, "sample_id"]),]
experimentInfo <-
experimentInfo[experimentInfo[, "visit"] %in% visits,]
experimentInfo <-
experimentInfo[experimentInfo[, "caseControl"] %in% cases,]
experimentInfo[, "group_id"] <- NA
experimentInfo[, "patient_id"] <-
factor(experimentInfo[, "patient_id"])
experimentInfo[, "sample_id"] <-
factor(experimentInfo[, "sample_id"])
experimentInfo[, "gender"] <-
factor(experimentInfo[, "gender"])
experimentInfo[, "ageAtVisit"] <-
factor(experimentInfo[, "ageAtVisit"])
experimentInfo[, "ageAtVisitDouble"] <-
as.double(experimentInfo[, "ageAtVisit"])
experimentInfo[, "fastSlow"] <-
factor(experimentInfo[, "fastSlow"])
experimentInfo[, "bulbarLimb"] <-
factor(experimentInfo[, "bulbarLimb"])
experimentInfo[, "caseControl"] <-
factor(experimentInfo[, "caseControl"])
experimentInfo[, "visit"] <-
as.double(experimentInfo[, "visit"])
experimentInfo[, "group_id"] <-
factor(experimentInfo[, group_id])
experimentInfo[, "ageAtVisitDouble"]
experimentInfo[, "ageAtVisit"]
# Read experiment data
experimentInfo <- read.csv("data/metadata/metadata.csv")
if (markersOrCell != "Clusters") {
cellPopulationMarkers <- read.csv(paste0("data/", directoryName, "/clusteringOutput/", clusterName, markersOrCell, ".csv"))
}
if (directoryName == "monocytes") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074-2", arr.ind=TRUE), "sample_id"] <- "BLT00074-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075-4", arr.ind=TRUE), "sample_id"] <- "BLT00075-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00092-6", arr.ind=TRUE), "sample_id"] <- "BLT00092-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186-6", arr.ind=TRUE), "sample_id"] <- "BLT00186-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-09"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-3", arr.ind=TRUE), "sample_id"] <- "BLT00211-03"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-6", arr.ind=TRUE), "sample_id"] <- "BLT00211-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-6", arr.ind=TRUE), "sample_id"] <- "BLT00211-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-2", arr.ind=TRUE), "sample_id"] <- "BLT00214-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-5", arr.ind=TRUE), "sample_id"] <- "BLT00214-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00230-2", arr.ind=TRUE), "sample_id"] <- "BLT00230-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243-7", arr.ind=TRUE), "sample_id"] <- "BLT00243-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-4", arr.ind=TRUE), "sample_id"] <- "BLT00244-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-6", arr.ind=TRUE), "sample_id"] <- "BLT00244-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-6", arr.ind=TRUE), "sample_id"] <- "BLT00244-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00254-5", arr.ind=TRUE), "sample_id"] <- "BLT00254-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00254-7", arr.ind=TRUE), "sample_id"] <- "BLT00254-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-4", arr.ind=TRUE), "sample_id"] <- "BLT00265-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-4", arr.ind=TRUE), "sample_id"] <- "BLT00265-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-8", arr.ind=TRUE), "sample_id"] <- "BLT00265-08"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00271-4", arr.ind=TRUE), "sample_id"] <- "BLT00271-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00271-7", arr.ind=TRUE), "sample_id"] <- "BLT00271-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-6", arr.ind=TRUE), "sample_id"] <- "BLT00274-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-3", arr.ind=TRUE), "sample_id"] <- "BLT00285-03"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-5", arr.ind=TRUE), "sample_id"] <- "BLT00285-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-5", arr.ind=TRUE), "sample_id"] <- "BLT00285-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00286-6", arr.ind=TRUE), "sample_id"] <- "BLT00286-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244_02", arr.ind=TRUE), "sample_id"] <- "BLT0244_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="QS_024-2", arr.ind=TRUE), "sample_id"] <- "QS_024-02"
} else if (directoryName == "senescence") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074_04", arr.ind=TRUE), "sample_id"] <- "BLT00074-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075_06", arr.ind=TRUE), "sample_id"] <- "BLT00075-6"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_02", arr.ind=TRUE), "sample_id"] <- "BLT00186-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-9"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00261_2", arr.ind=TRUE), "sample_id"] <- "BLT00261-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075-4", arr.ind=TRUE), "sample_id"] <- "BLT00075-4_R1"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-3", arr.ind=TRUE), "sample_id"] <- "BLT00211-3 "
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-5", arr.ind=TRUE), "sample_id"] <- "BLT000214-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00057_04", arr.ind=TRUE), "sample_id"] <- "BLT00057-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00092_04", arr.ind=TRUE), "sample_id"] <- "BLT00092_4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00198_02", arr.ind=TRUE), "sample_id"] <- "BLT00198_2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214_04", arr.ind=TRUE), "sample_id"] <- "BLT00214-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00230_04", arr.ind=TRUE), "sample_id"] <- "BLT00230-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00242_02", arr.ind=TRUE), "sample_id"] <- "BLT00242-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243_05", arr.ind=TRUE), "sample_id"] <- "BLT00243-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274_02", arr.ind=TRUE), "sample_id"] <- "BLT00274-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243_05", arr.ind=TRUE), "sample_id"] <- "BLT00243-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274_02", arr.ind=TRUE), "sample_id"] <- "BLT00274-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-05", arr.ind=TRUE), "sample_id"] <- "BLT00274-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-5"
} else if (directoryName == "tCells") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_033_02", arr.ind=TRUE), "sample_id"] <- "BAS033_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074_04", arr.ind=TRUE), "sample_id"] <- "BLT00074-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075_06", arr.ind=TRUE), "sample_id"] <- "BLT00075-6"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_02", arr.ind=TRUE), "sample_id"] <- "BLT00186_2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS101", arr.ind=TRUE), "sample_id"] <- "BAS00101"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-9"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00261_2", arr.ind=TRUE), "sample_id"] <- "BLT00261_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-05", arr.ind=TRUE), "sample_id"] <- "BLT00274-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
}
experimentInfo <-
experimentInfo[order(experimentInfo[, "sample_id"]),]
experimentInfo <-
experimentInfo[experimentInfo[, "visit"] %in% visits,]
experimentInfo <-
experimentInfo[experimentInfo[, "caseControl"] %in% cases,]
experimentInfo[, "group_id"] <- NA
experimentInfo[, "patient_id"] <-
factor(experimentInfo[, "patient_id"])
experimentInfo[, "sample_id"] <-
factor(experimentInfo[, "sample_id"])
experimentInfo[, "gender"] <-
factor(experimentInfo[, "gender"])
experimentInfo[, "ageAtVisit"] <-
experimentInfo[, "ageAtVisit"]
experimentInfo[, "ageAtVisitDouble"] <-
as.double(experimentInfo[, "ageAtVisit"])
experimentInfo[, "fastSlow"] <-
factor(experimentInfo[, "fastSlow"])
experimentInfo[, "bulbarLimb"] <-
factor(experimentInfo[, "bulbarLimb"])
experimentInfo[, "caseControl"] <-
factor(experimentInfo[, "caseControl"])
experimentInfo[, "visit"] <-
as.double(experimentInfo[, "visit"])
experimentInfo[, "group_id"] <-
factor(experimentInfo[, group_id])
experimentInfo[, "ageAtVisit"]
experimentInfo
head(experimentInfo)
experimentInfo[, "ethnicity"] <-
factor(experimentInfo[, "ethnicity"])
experimentInfo[, "ethnicity"]
head(experimentInfo)
typeof(experimentInfo[, "ethnicity"])
typeof(experimentInfo[, "timeFromVisit1InDays"])
experimentInfo[, "timeFromVisit1InDaysDouble"] <-
as.double(experimentInfo[, "timeFromVisit1InDays"])
mycolors <- c("blue", "red", "black")
names(mycolors) <- c("DOWN", "UP", "NO")
workingDirectory <- getwd()
setwd(paste0("./data/", directoryName))
dir.create("differentialTestingOutputs", showWarnings = FALSE)
figureDirectory <- paste0(getwd(), "/figures/")
if (clusterName == "clusters_flowsom") {
df <- read.csv("clusteringOutput/flowSomDf.csv", nrows = 500000)
} else if (clusterName == "meta_clusters_flowsom") {
df <- read.csv("clusteringOutput/flowSomDf.csv")
} else if (clusterName == "clusters_phenograph") {
df <- read.csv("clusteringOutput/phenographDf.csv")
} else if (clusterName == "clusters_fast_pg") {
df <- read.csv("clusteringOutput/fastPGDf.csv")
}
df <- df[order(df[, "fileName"]),]
df <- df[df[, "fileName"] %in% experimentInfo[, "sample_id"],]
if (markersOrCell != "Clusters") {
df <- merge(df, cellPopulationMarkers[,c(clusterName, "cell_population")], by = clusterName, all.x = TRUE)
}
experimentInfo <- experimentInfo[experimentInfo[, "sample_id"] %in% df[, "fileName"], ]
head(df)
experimentInfo
head(merge(x = df, y = experimentInfo[, c("sample_id", colnames(experimentInfo)[1])], by.x = "fileName", by.y = "sample_id", all.x=TRUE))
df <- merge(x = df, y = experimentInfo[, c("sample_id", colnames(experimentInfo)[1])], by.x = "fileName", by.y = "sample_id", all.x=TRUE)
colnames(df)[-1]
colnames(df)[length(colnames(df))]
colnames(df)[length(colnames(df))] <- "fileNameId"
colnames(df)
minimalDf <- df[, c(columnNames, clusterName, "fileNameId")]
head(minimalDf)
listOfDfs <- list()
for (file in unique(minimalDf[, "fileName"])) {
minimalDfExtract <- minimalDf[minimalDf[, "fileName"] == file,]
minimalDfExtract <-
minimalDfExtract[, !(names(minimalDfExtract) %in% c("fileName"))]
listOfDfs <- append(listOfDfs, list(minimalDfExtract))
}
markerColumnNames <- columnNames[columnNames != "fileName"]
markerInformation <- data.frame(markerColumnNames)
markerInformation[, "channel_name"] <- markerColumnNames
markerInformation[, "marker_name"] <- markerColumnNames
markerInformation[, "marker_class"] <-
c(rep("type", length(markerColumnNames)-2), rep("state", 2))
markerInformation <-
markerInformation[, 2:ncol(markerInformation)]
markerInformation
d_se <- prepareData(listOfDfs, experimentInfo, markerInformation)
library(foreach)
library(doParallel)
library(ranger)
library(palmerpenguins)
library(kableExtra)
library(parallel)
library(R.utils)
library(stringr)
library(flowCore)
library(Biobase)
library(dplyr)
library(flowVS)
library(flowStats)
library(R.utils)
library(flowCore)
library(FlowSOM)
library(SingleCellExperiment)
library(dplyr)
library(ggplot2)
library(scales)
library(reshape2)
library(RColorBrewer)
library(destiny)
library(uwot)
library(slingshot)
library(cytofkit2)
library(ggrepel)
library(tidyverse)
library(diffcyt)
library(corrplot)
library(cluster)
library(factoextra)
library(NbClust)
require(vegan)
library(apcluster)
library(mclust)
d_se <- prepareData(listOfDfs, experimentInfo, markerInformation)
markerColumnNames <- c(columnNames[columnNames != "fileName"], "clusterId", "fileNameId")
markerInformation <- data.frame(markerColumnNames)
markerColumnNames <- c(columnNames[columnNames != "fileName"], "clusterId", "fileNameId")
markerInformation <- data.frame(markerColumnNames)
markerInformation[, "channel_name"] <- markerColumnNames
markerInformation[, "marker_name"] <- markerColumnNames
markerInformation
markerInformation[, "marker_class"] <-
rep("type", length(markerColumnNames))
markerInformation
markerInformation <- markerInformation[, 2:ncol(markerInformation)]
markerInformation
2:ncol(markerInformation)
markerInformation
markerColumnNames <- c(columnNames[columnNames != "fileName"], "clusterId", "fileNameId")
markerInformation <- data.frame(markerColumnNames)
markerInformation[, "channel_name"] <- markerColumnNames
markerInformation[, "marker_name"] <- markerColumnNames
markerInformation[, "marker_class"] <-
rep("type", length(markerColumnNames))
markerInformation <- markerInformation[, 2:ncol(markerInformation)]
markerInformation
columnNames
markerColumnNames <- c("clusterId", "fileNameId", columnNames[columnNames != "fileName"])
markerInformation <- data.frame(markerColumnNames)
markerInformation[, "channel_name"] <- markerColumnNames
markerInformation[, "marker_name"] <- markerColumnNames
markerInformation[, "marker_class"] <-
c(rep("type", length(markerColumnNames)-2), rep("state", 2))
markerInformation <- markerInformation[, 2:ncol(markerInformation)]
markerInformation
d_se <- prepareData(listOfDfs, experimentInfo, markerInformation)
head(assay(d_se))
rowData(d_se)[, "cluster_id"] <- assay(d_se)[, "clusterId"]
assay(d_se)[, "clusterId"] ==
df[, "cell_population"]
df[, "cell_population"]
experimentInfo
rowData(d_se)
rowData(d_se)[, "cluster_id"] == df[, clusterName]
rowData(d_se)[, "cluster_id"] <- assay(d_se)[, "clusterId"]
clusterName
markersOrCell
cellPopulationMarkers <- read.csv(paste0("data/", directoryName, "/clusteringOutput/", clusterName, "Markers", ".csv"))
rowData(d_se)
rowData(d_se)[1]
head(assay(d_se))
markersOrCell <- "Markers"
getwd()
setwd("..")
setwd("..")
concatinatedVisits <- toString(visits)
# Read experiment data
experimentInfo <- read.csv("data/metadata/metadata.csv")
if (markersOrCell != "Clusters") {
cellPopulationMarkers <- read.csv(paste0("data/", directoryName, "/clusteringOutput/", clusterName, markersOrCell, ".csv"))
}
if (directoryName == "monocytes") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074-2", arr.ind=TRUE), "sample_id"] <- "BLT00074-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075-4", arr.ind=TRUE), "sample_id"] <- "BLT00075-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00092-6", arr.ind=TRUE), "sample_id"] <- "BLT00092-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186-6", arr.ind=TRUE), "sample_id"] <- "BLT00186-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-09"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-3", arr.ind=TRUE), "sample_id"] <- "BLT00211-03"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-6", arr.ind=TRUE), "sample_id"] <- "BLT00211-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-6", arr.ind=TRUE), "sample_id"] <- "BLT00211-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-2", arr.ind=TRUE), "sample_id"] <- "BLT00214-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-5", arr.ind=TRUE), "sample_id"] <- "BLT00214-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00230-2", arr.ind=TRUE), "sample_id"] <- "BLT00230-02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243-7", arr.ind=TRUE), "sample_id"] <- "BLT00243-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-4", arr.ind=TRUE), "sample_id"] <- "BLT00244-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-6", arr.ind=TRUE), "sample_id"] <- "BLT00244-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244-6", arr.ind=TRUE), "sample_id"] <- "BLT00244-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00254-5", arr.ind=TRUE), "sample_id"] <- "BLT00254-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00254-7", arr.ind=TRUE), "sample_id"] <- "BLT00254-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-4", arr.ind=TRUE), "sample_id"] <- "BLT00265-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-4", arr.ind=TRUE), "sample_id"] <- "BLT00265-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00265-8", arr.ind=TRUE), "sample_id"] <- "BLT00265-08"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00271-4", arr.ind=TRUE), "sample_id"] <- "BLT00271-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00271-7", arr.ind=TRUE), "sample_id"] <- "BLT00271-07"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-6", arr.ind=TRUE), "sample_id"] <- "BLT00274-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-3", arr.ind=TRUE), "sample_id"] <- "BLT00285-03"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-5", arr.ind=TRUE), "sample_id"] <- "BLT00285-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00285-5", arr.ind=TRUE), "sample_id"] <- "BLT00285-05"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-04"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00286-6", arr.ind=TRUE), "sample_id"] <- "BLT00286-06"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00244_02", arr.ind=TRUE), "sample_id"] <- "BLT0244_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="QS_024-2", arr.ind=TRUE), "sample_id"] <- "QS_024-02"
} else if (directoryName == "senescence") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074_04", arr.ind=TRUE), "sample_id"] <- "BLT00074-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075_06", arr.ind=TRUE), "sample_id"] <- "BLT00075-6"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_02", arr.ind=TRUE), "sample_id"] <- "BLT00186-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-9"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00261_2", arr.ind=TRUE), "sample_id"] <- "BLT00261-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075-4", arr.ind=TRUE), "sample_id"] <- "BLT00075-4_R1"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00211-3", arr.ind=TRUE), "sample_id"] <- "BLT00211-3 "
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214-5", arr.ind=TRUE), "sample_id"] <- "BLT000214-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00057_04", arr.ind=TRUE), "sample_id"] <- "BLT00057-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00092_04", arr.ind=TRUE), "sample_id"] <- "BLT00092_4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00198_02", arr.ind=TRUE), "sample_id"] <- "BLT00198_2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00214_04", arr.ind=TRUE), "sample_id"] <- "BLT00214-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00230_04", arr.ind=TRUE), "sample_id"] <- "BLT00230-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00242_02", arr.ind=TRUE), "sample_id"] <- "BLT00242-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243_05", arr.ind=TRUE), "sample_id"] <- "BLT00243-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274_02", arr.ind=TRUE), "sample_id"] <- "BLT00274-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00243_05", arr.ind=TRUE), "sample_id"] <- "BLT00243-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274_02", arr.ind=TRUE), "sample_id"] <- "BLT00274-2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-05", arr.ind=TRUE), "sample_id"] <- "BLT00274-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-5"
} else if (directoryName == "tCells") {
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_033_02", arr.ind=TRUE), "sample_id"] <- "BAS033_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS_057_02", arr.ind=TRUE), "sample_id"] <- "BAS057_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00074_04", arr.ind=TRUE), "sample_id"] <- "BLT00074-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00075_06", arr.ind=TRUE), "sample_id"] <- "BLT00075-6"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_02", arr.ind=TRUE), "sample_id"] <- "BLT00186_2"
experimentInfo[which(experimentInfo[, "sample_id"]=="BAS101", arr.ind=TRUE), "sample_id"] <- "BAS00101"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00186_9", arr.ind=TRUE), "sample_id"] <- "BLT00186-9"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00261_2", arr.ind=TRUE), "sample_id"] <- "BLT00261_02"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00274-05", arr.ind=TRUE), "sample_id"] <- "BLT00274-5"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT000286-4", arr.ind=TRUE), "sample_id"] <- "BLT00286-4"
experimentInfo[which(experimentInfo[, "sample_id"]=="BLT00297_2", arr.ind=TRUE), "sample_id"] <- "BLT00297-2"
}
experimentInfo <-
experimentInfo[order(experimentInfo[, "sample_id"]),]
experimentInfo <-
experimentInfo[experimentInfo[, "visit"] %in% visits,]
experimentInfo <-
experimentInfo[experimentInfo[, "caseControl"] %in% cases,]
experimentInfo[, "group_id"] <- NA
experimentInfo[, "patient_id"] <-
factor(experimentInfo[, "patient_id"])
experimentInfo[, "sample_id"] <-
factor(experimentInfo[, "sample_id"])
experimentInfo[, "gender"] <-
factor(experimentInfo[, "gender"])
experimentInfo[, "ageAtVisit"] <-
experimentInfo[, "ageAtVisit"]
experimentInfo[, "ageAtVisitDouble"] <-
as.double(experimentInfo[, "ageAtVisit"])
experimentInfo[, "fastSlow"] <-
factor(experimentInfo[, "fastSlow"])
experimentInfo[, "bulbarLimb"] <-
factor(experimentInfo[, "bulbarLimb"])
experimentInfo[, "caseControl"] <-
factor(experimentInfo[, "caseControl"])
experimentInfo[, "visit"] <-
as.double(experimentInfo[, "visit"])
experimentInfo[, "group_id"] <-
factor(experimentInfo[, group_id])
experimentInfo[, "ethnicity"] <-
factor(experimentInfo[, "ethnicity"])
experimentInfo[, "timeFromVisit1InDaysDouble"] <-
as.double(experimentInfo[, "timeFromVisit1InDays"])
mycolors <- c("blue", "red", "black")
names(mycolors) <- c("DOWN", "UP", "NO")
workingDirectory <- getwd()
setwd(paste0("./data/", directoryName))
dir.create("differentialTestingOutputs", showWarnings = FALSE)
figureDirectory <- paste0(getwd(), "/figures/")
df <- read.csv("clusteringOutput/flowSomDf.csv", nrows = 500000)
df <- df[order(df[, "fileName"]),]
# Filter df for samples
df <- df[df[, "fileName"] %in% experimentInfo[, "sample_id"],]
if (markersOrCell != "Clusters") {
df <- merge(df, cellPopulationMarkers[,c(clusterName, "cell_population")], by = clusterName, all.x = TRUE)
}
# Filter df for samples
experimentInfo <- experimentInfo[experimentInfo[, "sample_id"] %in% df[, "fileName"], ]
df <- merge(x = df, y = experimentInfo[, c("sample_id", colnames(experimentInfo)[1])], by.x = "fileName", by.y = "sample_id", all.x=TRUE)
colnames(df)[length(colnames(df))] <- "fileNameId"
# Extract only the relevant columns
minimalDf <- df[, c(clusterName , "fileNameId", columnNames)]
# split the dataframe into a dataframe for each file
listOfDfs <- list()
for (file in unique(minimalDf[, "fileName"])) {
minimalDfExtract <- minimalDf[minimalDf[, "fileName"] == file,]
minimalDfExtract <-
minimalDfExtract[, !(names(minimalDfExtract) %in% c("fileName"))]
listOfDfs <- append(listOfDfs, list(minimalDfExtract))
}
# Create marker information
markerColumnNames <- c("clusterId", "fileNameId", columnNames[columnNames != "fileName"])
markerInformation <- data.frame(markerColumnNames)
markerInformation[, "channel_name"] <- markerColumnNames
markerInformation[, "marker_name"] <- markerColumnNames
markerInformation[, "marker_class"] <-
c(rep("type", length(markerColumnNames)-2), rep("state", 2))
markerInformation <- markerInformation[, 2:ncol(markerInformation)]
# Transform the input into the correct format
d_se <- prepareData(listOfDfs, experimentInfo, markerInformation)
head(df)
clusterName
df[, "clusters_flowsom"] == assay(d_se)[, "clusterId"]
head(rowData(d_se))
rowData(d_se)[1]
head(df)
rowData(d_se)[1] == df[, "fileNameId"]
length(df[, "fileNameId"])
length(rowData(d_se)[,1])
rowData(d_se)[,1] == df[, "fileNameId"]
all(rowData(d_se)[,1] == df[, "fileNameId"])
all(df[, "clusters_flowsom"] == assay(d_se)[, "clusterId"])
