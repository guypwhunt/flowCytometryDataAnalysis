x <- summary(x)
p.value <-
signif(x$wald["pvalue"], digits = 2)
wald.test <-
signif(x$wald["test"], digits = 2)
beta <-
signif(x$coef[1], digits = 2)
#coeficient beta
HR <-
signif(x$coef[2], digits = 2)
#exp(beta)
HR.confint.lower <-
signif(x$conf.int[, "lower .95"], 2)
HR.confint.upper <-
signif(x$conf.int[, "upper .95"], 2)
HR <- paste0(HR, " (",
HR.confint.lower, "-", HR.confint.upper, ")")
res <- c(beta, HR, wald.test, p.value)
names(res) <-
c("beta", "HR (95% CI for HR)", "wald.test",
"p.value")
return(res)
#return(exp(cbind(coef(x),confint(x))))
})
univ_results$ethnicityID <- univ_results$ethnicityID[c(1, 2, 4, 5)]
names(univ_results$ethnicityID) <- names(univ_results$sex)
res <- t(as.data.frame(univ_results, check.names = FALSE))
as.data.frame(res)
res.cox <-
coxph(as.formula(
paste(
"Surv(diseaseDurationInYears, status) ~ 0",
sapply(list(clinicalCovariates), paste, collapse =
" + "),
sep = " + "
)
)
, data = minDF)
library(MASS)
step <- stepAIC(res.cox, direction = "both")
step$anova
censored.clinical.res.cox <-
coxph(
Surv(diseaseDurationInYears, status) ~ alsfrsR + timeFromOnsetToVisitInYears -
1,
data = minDF
)
censored.clinical.res.cox.summary <-
summary(censored.clinical.res.cox)
saveRDS(censored.clinical.res.cox, file = paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationClinicalModel.rds"
))
write.csv(
as.data.frame(censored.clinical.res.cox.summary$coefficients),
paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationClinicalModel.csv"
),
row.names = TRUE
)
ggsurvplot(
survfit(censored.clinical.res.cox, data = minDF),
palette = "#2E9FDF",
ggtheme = theme_minimal()
)
res.cox <-
coxph(as.formula(
paste(
"Surv(diseaseDurationInYears, status) ~ 0",
sapply(list(clinicalAndBiologicalCovariates), paste, collapse =
" + "),
sep = " + "
)
)
, data = minDF)
library(MASS)
step <- stepAIC(res.cox, direction = "both")
step$anova
censored.clinical.biological.res.cox <-
coxph(
Surv(diseaseDurationInYears, status) ~ sex + onset + alsfrsR +
timeFromOnsetToVisitInYears + diagnosticDelayInYears + ageAtOnset +
riluzole + delataAlsfrsRScore + GPR32_median_Positive_Naïve_B_Cells +
GPR32_median_Positive_HLA_Negative_DR_Negative_Or_Low_Activated_CD11b_Positive__Classical_Monocytes +
GPR32_median_Positive_HLA_Negative_DR_Negative_Or_Low_Intermediate_Monocytes -
1,
data = minDF
)
saveRDS(censored.clinical.biological.res.cox, file = paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationBiologicalModel.rds"
))
censored.clinical.biological.res.cox.summary <-
summary(censored.clinical.biological.res.cox)
write.csv(
as.data.frame(censored.clinical.biological.res.cox.summary$coefficients),
paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationBiologicalModel.csv"
),
row.names = TRUE
)
ggsurvplot(
survfit(censored.clinical.biological.res.cox, data = minDF),
palette = "#2E9FDF",
ggtheme = theme_minimal()
)
x <-
anova(censored.clinical.res.cox,
censored.clinical.biological.res.cox)
write.csv(
as.data.frame(x),
paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationClinicalVsBiologicalModel.csv"
),
row.names = TRUE
)
print(x)
try(source("R/01_functions.R"))
try(source("R/00_datasets.R"))
library(survival)
library(survminer)
loadlibraries()
clusterNames <- clusterColumns
markersOrCells <- markersOrCellsClassification
clusterName <- clusterNames[2]
markersOrCell <- markersOrCells[1]
experimentInfo <- read_excel("data/metadata/clinicalData.xlsx")
experimentInfo <- as.data.frame(experimentInfo)
experimentInfo <- experimentInfo[experimentInfo$visit == 1,]
experimentInfo <-
experimentInfo[experimentInfo$experiment == "flowCytometry",]
experimentInfo <-
experimentInfo[experimentInfo$caseControl == "Case",]
filePath <- "data/medianValues/"
fileNames <- list.files(filePath)
fileNames <-
fileNames[grep(clusterName, fileNames, fixed = FALSE)]
fileNames <-
fileNames[grep(markersOrCell, fileNames, fixed = FALSE)]
fileNamesPath <- paste0(filePath, fileNames)
dfs <- lapply(fileNamesPath, read.csv)
for (df in dfs) {
if (exists("mergedDF")) {
mergedDF <- merge(mergedDF, df, by = "fileName", all = TRUE)
} else {
mergedDF <- df
}
}
#mergedDF <- mergedDF[mergedDF$fileName %in% experimentInfo$sample_id,]
#experimentInfo <- experimentInfo[experimentInfo$sample_id %in% mergedDF$fileName,]
combinedDf <- merge(
mergedDF,
experimentInfo,
by.x = "fileName",
by.y = "sample_id",
all.x = TRUE
)
dateOfLateOutCome <-
combinedDf[is.na(combinedDf$outcomeDeathDate), c("outcomeLastVisitDate", "visitDate")]
dateOfLateOutCome <-
(dateOfLateOutCome$outcomeLastVisitDate - dateOfLateOutCome$visitDate) /
(24 * 60 * 60 * 365.25)
combinedDf[is.na(combinedDf$outcomeDeathDate), "diseaseDurationInYears"] <-
dateOfLateOutCome
combinedDf$fileName <- factor(combinedDf$fileName)
combinedDf$diseaseDurationInYears <-
combinedDf$diseaseDurationInYears * 365.25
combinedDf$outcome <- factor(combinedDf$outcome)
combinedDf$status <- as.numeric(combinedDf$outcome)
combinedDf$status <- ifelse(combinedDf$status == 2, 1, 0)
combinedDf$gender <- factor(combinedDf$gender)
combinedDf$sex <- as.numeric(combinedDf$gender)
combinedDf$ethnicity <- factor(combinedDf$ethnicity)
combinedDf$ethnicityID <- as.numeric(combinedDf$ethnicity)
combinedDf$BulbarLimb <- factor(combinedDf$BulbarLimb)
combinedDf$onset <- as.numeric(combinedDf$BulbarLimb)
clinicalCovariates <- c(
"ageAtVisit",
"sex",
"ethnicityID",
"onset",
"alsfrsR",
"timeFromOnsetToVisitInYears",
"diagnosticDelayInYears",
"ageAtOnset",
"riluzole",
"delataAlsfrsRScore"
)
biologicalCovariates <- c(colnames(mergedDF)[colnames(mergedDF) != "fileName"])
clinicalAndBiologicalCovariates <-
append(clinicalCovariates, biologicalCovariates)
combinedDf$sex <- as.factor(combinedDf$sex)
combinedDf$ethnicityID <- as.factor(combinedDf$ethnicityID)
combinedDf$onset <- as.factor(combinedDf$onset)
# Censored Analysis
minDF <-
combinedDf[, c("diseaseDurationInYears",
"status",
clinicalAndBiologicalCovariates)]
minDF <- na.omit(minDF)
# Univariate Analysis
univ_formulas <- sapply(clinicalAndBiologicalCovariates,
function(x)
as.formula(paste(
'Surv(diseaseDurationInYears, status)~', x
)))
univ_models <-
lapply(univ_formulas, function(x) {
coxph(x, data = minDF)
})
# Extract data
univ_results <- lapply(univ_models,
function(x) {
x <- summary(x)
p.value <-
signif(x$wald["pvalue"], digits = 2)
wald.test <-
signif(x$wald["test"], digits = 2)
beta <-
signif(x$coef[1], digits = 2)
#coeficient beta
HR <-
signif(x$coef[2], digits = 2)
#exp(beta)
HR.confint.lower <-
signif(x$conf.int[, "lower .95"], 2)
HR.confint.upper <-
signif(x$conf.int[, "upper .95"], 2)
HR <- paste0(HR, " (",
HR.confint.lower, "-", HR.confint.upper, ")")
res <- c(beta, HR, wald.test, p.value)
names(res) <-
c("beta", "HR (95% CI for HR)", "wald.test",
"p.value")
return(res)
#return(exp(cbind(coef(x),confint(x))))
})
univ_results$ethnicityID <- univ_results$ethnicityID[c(1, 2, 4, 5)]
names(univ_results$ethnicityID) <- names(univ_results$sex)
res <- t(as.data.frame(univ_results, check.names = FALSE))
as.data.frame(res)
res.cox <-
coxph(as.formula(
paste(
"Surv(diseaseDurationInYears, status) ~ 0",
sapply(list(clinicalCovariates), paste, collapse =
" + "),
sep = " + "
)
)
, data = minDF)
library(MASS)
step <- stepAIC(res.cox, direction = "both")
step$anova
censored.clinical.res.cox <-
coxph(
Surv(diseaseDurationInYears, status) ~ alsfrsR + timeFromOnsetToVisitInYears -
1,
data = minDF
)
saveRDS(censored.clinical.res.cox, file = paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationClinicalModel.rds"
))
censored.clinical.res.cox.summary <-
summary(censored.clinical.res.cox)
write.csv(
as.data.frame(censored.clinical.res.cox.summary$coefficients),
paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationClinicalModel.csv"
),
row.names = TRUE
)
ggsurvplot(
survfit(censored.clinical.res.cox, data = minDF),
palette = "#2E9FDF",
ggtheme = theme_minimal()
)
res.cox <-
coxph(as.formula(
paste(
"Surv(diseaseDurationInYears, status) ~ 0",
sapply(list(clinicalAndBiologicalCovariates), paste, collapse =
" + "),
sep = " + "
)
)
, data = minDF)
library(MASS)
step <- stepAIC(res.cox, direction = "both")
step$anova
censored.clinical.biological.res.cox <-
coxph(
Surv(diseaseDurationInYears, status) ~ sex + onset + alsfrsR +
timeFromOnsetToVisitInYears + diagnosticDelayInYears + riluzole +
delataAlsfrsRScore + GPR32_median_Positive_Naïve_B_Cells +
GPR32_median_Positive_HLA_Negative_DR_Negative_Or_Low_Classical_Monocytes +
GPR32_median_Positive_HLA_Negative_DR_Negative_Or_Low_Activated_CD11b_Positive__Classical_Monocytes +
GPR32_median_Positive_HLA_Negative_DR_Negative_Or_Low_Intermediate_Monocytes -
1,
data = minDF
)
saveRDS(censored.clinical.biological.res.cox, file = paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationBiologicalModel.rds"
))
censored.clinical.biological.res.cox.summary <-
summary(censored.clinical.biological.res.cox)
write.csv(
as.data.frame(censored.clinical.biological.res.cox.summary$coefficients),
paste0(
"data/survivalAnalysis/",
clusterName,
"DiseaseDurationBiologicalModel.csv"
),
row.names = TRUE
)
ggsurvplot(
survfit(censored.clinical.biological.res.cox, data = minDF),
palette = "#2E9FDF",
ggtheme = theme_minimal()
)
try(source("R/01_functions.R"))
try(source("R/00_datasets.R"))
library(survival)
library(survminer)
loadlibraries()
cpddbm <- readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationBiologicalModel.rds")
cpddbm <- readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationBiologicalModel.rds")
cpddcm <- readRDS("clusters_phenographDiseaseDurationClinicalModel.rds")
cpddbm <- readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationBiologicalModel.rds")
cpddcm <- readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationClinicalModel.rds")
cpsfvbm <- readRDS("data/survivalAnalysis/clusters_phenographSurvivalFromVisitBiologicalModel.rds")
cpsfvcm <- readRDS("data/survivalAnalysis/clusters_phenographSurvivalFromVisitClinicalModel.rds")
mcfddbm <- readRDS("data/survivalAnalysis/meta_clusters_flowsomDiseaseDurationBiologicalModel")
cpddbm <- readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationBiologicalModel.rds")
cpddcm <- readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationClinicalModel.rds")
cpsfvbm <- readRDS("data/survivalAnalysis/clusters_phenographSurvivalFromVisitBiologicalModel.rds")
cpsfvcm <- readRDS("data/survivalAnalysis/clusters_phenographSurvivalFromVisitClinicalModel.rds")
mcfddbm <- readRDS("data/survivalAnalysis/meta_clusters_flowsomDiseaseDurationBiologicalModel.rds")
mcfddcm <- readRDS("data/survivalAnalysis/meta_clusters_flowsomDiseaseDurationClinicalModel.rds")
mcfsfvbm <- readRDS("data/survivalAnalysis/meta_clusters_flowsomSurvivalFromVisitBiologicalModel.rds")
mcfsfvcm <- readRDS("data/survivalAnalysis/meta_clusters_flowsomSurvivalFromVisitClinicalModel.rds")
ddComparison <-
anova(cpddbm, cpddcm, mcfddbm, mcfddcm
)
print(ddComparison)
ddComparison <-
anova(cpddcm, mcfddcm, cpddbm, mcfddbm
)
print(ddComparison)
dir.create("data/survivalAnalysis/compareAllModels/")
write.csv(
as.data.frame(x),
paste0(
"data/survivalAnalysis/compareAllModels/",
"diseaseDuration.csv"
),
row.names = TRUE
)
write.csv(
as.data.frame(ddComparison),
paste0(
"data/survivalAnalysis/compareAllModels/",
"diseaseDuration.csv"
),
row.names = TRUE
)
sfvComparison <-
anova(cpsfvcm, mcfsfvcm, cpsfvbm, mcfsfvbm
)
dir.create("data/survivalAnalysis/compareAllModels/")
sfvComparison
write.csv(
as.data.frame(sfvComparison),
paste0(
"data/survivalAnalysis/compareAllModels/",
"diseaseDuration.csv"
),
row.names = TRUE
)
allComparison <-
anova(cpddcm, mcfddcm, cpddbm, mcfddbm, cpsfvcm, mcfsfvcm, cpsfvbm, mcfsfvbm
)
try(source("R/01_functions.R"))
try(source("R/00_datasets.R"))
library(survival)
library(survminer)
loadlibraries()
cpddbm <-
readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationBiologicalModel.rds")
cpddcm <-
readRDS("data/survivalAnalysis/clusters_phenographDiseaseDurationClinicalModel.rds")
cpsfvbm <-
readRDS(
"data/survivalAnalysis/clusters_phenographSurvivalFromVisitBiologicalModel.rds"
)
cpsfvcm <-
readRDS("data/survivalAnalysis/clusters_phenographSurvivalFromVisitClinicalModel.rds")
mcfddbm <-
readRDS(
"data/survivalAnalysis/meta_clusters_flowsomDiseaseDurationBiologicalModel.rds"
)
mcfddcm <-
readRDS("data/survivalAnalysis/meta_clusters_flowsomDiseaseDurationClinicalModel.rds")
mcfsfvbm <-
readRDS(
"data/survivalAnalysis/meta_clusters_flowsomSurvivalFromVisitBiologicalModel.rds"
)
mcfsfvcm <-
readRDS(
"data/survivalAnalysis/meta_clusters_flowsomSurvivalFromVisitClinicalModel.rds"
)
ddComparison <-
anova(cpddcm, mcfddcm, cpddbm, mcfddbm
)
dir.create("data/survivalAnalysis/compareAllModels/")
write.csv(
as.data.frame(ddComparison),
paste0(
"data/survivalAnalysis/compareAllModels/",
"diseaseDuration.csv"
),
row.names = TRUE
)
sfvComparison <-
anova(cpsfvcm, mcfsfvcm, cpsfvbm, mcfsfvbm
)
dir.create("data/survivalAnalysis/compareAllModels/")
write.csv(
as.data.frame(sfvComparison),
paste0(
"data/survivalAnalysis/compareAllModels/",
"survivalFromVisit.csv"
),
row.names = TRUE
)
install.packages("fpc")
library(fpc)
set.seed(20000)
face <- rFace(50,dMoNo=2,dNoEy=0,p=2)
cf1 <- clusterboot(face,B=3,bootmethod=
c("boot","noise","jitter"),clustermethod=kmeansCBI,
krange=5,seed=15555)
print(cf1)
plot(cf1)
plot(cf1)
require(graphics)
x <- matrix(rnorm(100), nrow = 5)
dist(x)
dev.off()
dev.off()
require(graphics)
x <- matrix(rnorm(100), nrow = 5)
dist(x)
x
rnorm(100)
x <- matrix(rnorm(100), nrow = 5)
dist(x)
dist(x, diag = TRUE)
dist(x, upper = TRUE)
dist(x, diag = TRUE, upper = TRUE)
y <- dist(x, diag = TRUE, upper = TRUE)
typeof(y)
class(y)
cf2 <- clusterboot(y,B=3,bootmethod=
c("boot","noise","jitter"),clustermethod=kmeansCBI,
krange=5,seed=15555)
cf2 <- clusterboot(y,B=3,bootmethod="subset",
clustermethod=disthclustCBI,
k=5, cut="number", method="average",
showplots=TRUE, seed=15555)
cf2
print(cf2)
cf2 <- clusterboot(y,B=3,bootmethod="subset",
clustermethod=disthclustCBI,
k=5, cut="number", method="average",
showplots=TRUE, seed=15555)
print(cf2)
cf2
face <- rFace(50,dMoNo=2,dNoEy=0,p=2)
cf2 <- clusterboot(dist(face),B=3,bootmethod=
"subset",clustermethod=disthclustCBI,
k=5, cut="number", method="average", showplots=TRUE, seed=15555)
face
dist(face)
face
as.data.frame(face)
cf2 <- clusterboot(dist(as.data.frame(face)),B=3,bootmethod=
"subset",clustermethod=disthclustCBI,
k=5, cut="number", method="average", showplots=TRUE, seed=15555)
print(cf2)
dev.off()
dev.off()
dev.off()
dev.off()
print(cf2)
cf2 <- clusterboot(dist(as.data.frame(face)),B=3,bootmethod=
"subset",clustermethod=disthclustCBI,
k=5, cut="number", method="average", showplots=TRUE, seed=15555)
